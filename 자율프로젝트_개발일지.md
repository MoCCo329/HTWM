### 2022/10/19/수

처음으로 CRA 없이 webpack과 babel, eslint, prettier 설정을 통해 React와 electron 개발환경을 구축했다. 구글링해서 한 것이고, 다시해도 검색없이는 못하겠지만 생각보다 어려운 작업은 없었다. 다만 몇가지 시간이 끌린 작업들이 있었다.

그중 하나는 build시 electron에 아무것도 안뜨는점이 문제였는데, webpack의 HtmlWebpackPlugin이 build시 index.html에 주입해 주는 js 파일의 경로가 잘못되어서였다. webpack output 설정에서 publickPath를 생각없이 복붙했다가 문제가 되었다.

구글링하면 환경변수로 react port 번호나 mode(publish, development) 등을 이용하는데, 환경변수를 사용한 내용을 보면 이런건 어떻게 배우거나 외우는건지 막막하다.

package.json의 한 스크립트에서 여러 명령어를 치려면 && 를 이용한다. 또 어떤 작업을 기다린 후 스크립트를 진행하려면 wait-on을 사용하면 된다.

electron에선 HashRouter 써야한다. url 변화 없이 파일기반 환경이기 때문에 해쉬값만 바꿔가며 보여줄 내용을 구분해야한다.

oracle vm에 라즈비안을 깐 뒤 빌드한 electron 설치파일을 테스트 해보려 했으나 가상환경 OS로 파일 옮기는 방식이 귀찮아서 보류했다.



### 2022/10/20/목

electron과 react간 ipc 통신을 확인했다. 모션인식에 사용되는 라즈베리파이에서 왭과 음성인식을 처리하는 라즈베리 파이로 데이터를 전송하면 electron이 react로 다시 ipc 통신을 하고, react에서 해당 데이터를 보여주거나 서버로 보내는 등의 데이터 처리를 진행한다. electron에서 주어지는 ipcMain과 ipcRenderer객체, webContents 메소드를 이용해 구현 가능하다.

webRTC 통신을 위해서 서버와의 소켓 API 형식을 맞췄다. API 문서에 작성했으며, 앱에서 서버로 실시간 트레이닝을 진행한다고 결정을 날리면 서버는 거울 기기에게 상대방 기기Id를 보내주게 된다. 그러면 기기는 해당 id를 URL일부로 사용하는 소켓을 통해 상대방 기기와 icebracking을 진행한다. 기기간 소켓통신의 경우 body의 type 속성에 2를 넣고 이땐 서버에서 처리없이 그냥 전송만 담당한다. 서버에서 기기로 통신을 시작하라고 기기Id를 전송할 땐 type을 1로 하여 여러 소켓경로를 사용하지 않아도 fe처리를 쉽게 하도록 했다.



### 2022/10/21/금

오늘은 코드를 짜지 않았다. 어제 6시 이후에 계속 개발하다 늦게 자기도 했고, 면접준비에 조금씩 신경써야 할 것 같아 할 일들을 정리하고 CS관련 책을 조금 읽었다. 그 후 팀에서 기기 패키징 설계와 필요 물품을 정리하는회의에 상당히 많은 시간을 들였다.



### 2022/10/24/월

메인 페이지에 띄울 날씨 API를 만졌다. 기상청 API를 활용했는데, 받아오는 내용이 정리되어있지 않아 이를 보여주기 편하게 정리하는 함수를 만들었다. 현 시간부터 12시간 안의 기상예보 데이터는 자세히 정리하며 그 외 데이터는 일별 최저, 최고, 강수확률만 기록하도록 했다.

근데 처음에는 제대로 오던 API가 함수를 완성하자 이상하게 호출되기 시작했다. 정보코드가 다양하게 와야 하는데 하나로 고정되어 왔다. 일당 5000번이니 너무 많이 호출해서 생기는 문제는 아닌데 내일 더 확인하고 고쳐야 겠다.



### 2022/10/25/화

윈도우 환경에서 electron webpack실행이나 window용 exe 파일로 빌드는 잘 되었는데, 라즈베리 파이에서 사용하기 위해 linux 옵션으로 빌드하면 계속 에러가 났다. 이를 위해 1,2시간 가량 찾아보며 이것저것 시도했지만 다 잘 안되었다. 무엇이 문제일까 감이 잘 잡히지 않는다.

어제 가공한 날씨 API결과를 시간별 그래프로 온도를 띄웠다. 메인페이지에서 앞으로 12시간 정도의 온도추이를 쉽게 알 수 있도록 하기 위함이였는데, 생각보다 가시성도 떨어지고 예쁘지 않아 그냥 글자로만 표현할 생각이다.



### 2022/10/26/수

오늘은 2학기 meet up이 있는 날이였고, 오전 미팅을 제외하면 계속 행사에 참여했기에 개발을 할 시간이 없었다. 다음주가 면접이고, 면접 준비도 너무 부족하다고 느끼는데 프로젝트와 면접 준비 어느것을 우선해야 하는지 헷갈리며 둘 다 잘 할 수 있을지도 걱정된다.



### 2022/10/27/목

메인페이지에 날씨와 시간을 단간히 띄워놓고 다음 작업으로 서버에서 소켓통신을 완성해서 전에 만들어둔 webRTC통신이 제대로 작동하는지 확인해보았다.

근데 역시 바로 작동하지 않았으며, 몇 가지 시행착오를 겪고도 오늘 디버깅을 완료하지 못했다. 첫 오류로는 stockJS가 wws protocol을 지원하지 않는다는 것이였다. sockJS는 websocket이나 https long pulling 등 몇 기술을 이용해 websocket이 불가능한 부라우저에서도 실시간 통신이 가능하게 해주는 라이브러리로 알고 있다. 그래서 https를 기본으로 사용하지 않나 싶다. 근데 백에선 지난 프로젝트처럼 구현한것일텐데, 전에는 어떻게 wss를 썼을지도 궁금하다. 이부분은 백에서 코드를 바꿔 해결 할 수 있었다.

다음은 JSON으로 stringify 해서 보내는 객체안에 원시타입이 아닌 참조형 객체를 넣어 보내면 응답이 오지 않는 문제였는데, 이게 잘못된것인지 찾는데 매우 오래걸렸다. 서버는 자바를 사용하고 JSON을 파싱해 객체안에 속성을 넣어 추가적인 편집을 하면서 문제가 생긴것으로 파악된다. 이부분을 백에게 말해주어 서버에서 파싱 후 속성을 넣는등의 편집을 안하고 그대로 보내주니 해결되었다.

다음 문제는 sockJS가 연결되기 전에 send를 하려 하는 등의 리액트 내에서 비동기적 문제들이였다. 이부분을 고치다가 시간이 되어 완료하지 못했다. 스프링을 모르기 때문에 프런트코트만 고쳐가며 디버깅했는데, 스프링도 볼 줄 알았다면 어땠을까 생각이 들었다. 이번 프로젝트가 끝나면 한번 배워봐야겠다.



### 2022/10/28/금

어제 못끝낸 webRTC 디버깅을 끝내고 싶었지만 실패했다. 몇시간 시도해보다 너무 시간이 끌리는 것 같아 다른 작업을 시작했다. 분명 addstream 이벤트까지 잘 작동하는데, 상대방 스트리밍 비디오가 나오지 않는다.

올해, 아니 근 몇년간 한번도 아픈적이 없었는데 환절기에 창문을 열어놓고 잤더니 감기에 걸렸는지 콧물이 나오고 집중이 잘 되지 않았다. 그래서 다른 페이지들의 기본적인 틀을 만드는 것처럼 쉽지만 시간이 조금 걸릴만한 작업들 위주로 했다.



### 2022/10/31/월

오늘은 운동 페이지를 완성했다. 실시간 트레이닝을 제외하면 가장 큰 볼륨의 페이지인데 큰 어려움 없이 끝났다. 세트에 따라 시간초를 보여주며 운동 카운트를 보여주고, 루틴(모든 세트)이 끝나면 기록한 결과들을 백으로 넘겨준뒤 메인페이지로 이동시키면 끝이였다.

아무래도 시간을 다루는 부분이 언제나 불안하긴 하다. useEffect로 컴포넌트가 실행됐을 때 계속해서 감소하는 시간초를 만들고 0초가 되면 세트를 바뀌며 시간도 다음 세트시간으로 업데이트 되도록 했다. 때문에 useEffect안에는 세트를 넘기는 함수가 호출되는데, 이 함수 안에 세트를 기록하는 함수호출도 들어간다. 하지만 세트 기록하는 부분에서 count가 useEffect의 컨텍스트인 0으로 고정되는 문제가 있었다. useRef를 써서 해결했으며, useEffect 안에서 useCallBack을 사용하여 변수가 달라지면 함수를 제정의 하도록 해봤는데 useEffect 안에서 useCallBack 정의는 불가능했다.



### 2022/11/01/화

어제 완성한 운동페이지에서 몇가지 부족한 부분이 있었는데, 운동이 끝났을 때 결과를 보내는 API가 200을 답하지만 DB에는 들어가지 않는 현상과, 운동시 틀어줄 비디오 URL이 운동조회 API에서 같이 오지 않는다는 점이였다. 아침에 백에게 이 점을 전달해서 API가 금방 수정이 되었고, 나도 비디오가 나오도록 기능을 추가했다.

지난번 이슈가 있던 webRTC를 고치려했다. 분명 addstream 이벤트까진 발생하는데, 왜 상대방 동영상이 나오지 않는지, 혹시 ssafy에서 사용하는 네트워크 문제인가 핫스팟으로 테스트도 해봤지만 똑같았다. 아무래도 처음부터 천천히 다시 만들어 보고 그래도 안된다면 openVidu같은 라이브러리를 사용해봐야 겠다.

내일 드디어 카카오 면접인데, 처음보는 면접이라 너무 떨리지만 준비가 미흡해서 인지 오히려 생각보단 덜 떨리는 느낌이기도 하다. 어느정도 내 페이스대로 답변하여 너무 좌절할 정도의 면접이 되지 않았음 좋겠다.



### 2022/11/02/수

프로젝트 외의 내용은 최대한 안적으려 하는데, 오늘은 개발한게 없어서 그냥 다른 내용을 적는다.

카카오 면접을 보면서 든 생각은 내가 너무나도 부족하단 것이였다. 중간쯤 이미 반 포기상태로 면접을 보았고, 오히려 면접관분들이 포기안하고 계속 물어봐주셨다.

알고리즘/자료구조에 대한 공부, 네트워크에 대한 공부, 운영체제에 대한 제대로된 이해가 필요하단걸 깨달았으며, 그것들을 확실히 아는것 부터가 전공자들과 비교대상에 설 수 있다는걸 깨달았다.



### 2022/11/03/목

오늘 드디어 webRTC가 제대로 작동했다. 하루이틀만에 끝냈어야 했는데 기간으로 따지면 거의 일주일이 걸린것 같다. 전에 있던 오류의 원인은 너무나 간단했는데, offer가 오면 해당 offer를 remoteDescription으로 넣은 뒤 answer를 생성해 상대에게 보내주게된다. 이때 localDescription으로 생성했던 answer를 넣어주어야 하는데 그 과정이 생략됐었다. 이런 어떻게 보면 당연한 부분을 며칠간 찾지 못하고 괜한 뻘짓들을 했다니 어이가 없었다.

let, const로 변수를 선언하고 해당 변수에 함수를 넣으면 호이스팅은 되지만 초기화가 되지 않아 함수 선언문처럼 바로 사용되지 못한다. 하지만 변수 선언보다 먼저쓰이는 useEffect(() => {f()}, []) 의 콜백함수로 들어가 있으면 문제가 되지 않았다. 처음엔 이 부분이 잘 이해가 되지 않아 useEffect(f, []) 처럼 적어봤는데, is not a function이 떴다. useEffect 내부적으로 함수인지 확인하는 과정이 있으며 이부분만 통과되면 비동기적으로 콜백함수가 작동하므로 그동안 변수(함수)선언문을 만나 빈 변수메모리에 그동안 선언된 함수의 메모리주소가 들어가게 되는것 같다.

사진촬영 페이지에서 캡처 후 url이미지를 blob으로 만들어 formdata로 서버에 넘기는 작업을 했다. 하지만 500에러가 뜨고 swagger에서는 잘 작동하기에 무엇이 문제인지 알아보다 집에 오게되었다.



### 2022/11/04/금

어제 잘 되지 않던 캡처한 이미지를 전송 API를 수정했다. header의 ContentType을 multipart/form-data에서 false로 바꾸니까 정상 작동을 했다. 헤더를 지워줘도 제대로 작동하지 않았는데, false 로 적지 않으면 boundary string이 생략되어 날아간다고 한다.

이 부분을 수정한 뒤에는 다음주 월요일에 있을 삼성 면접을 준비했다. 면접의 순간이 두려워 회피하고 싶고, 집중이 잘 되지 않았다. 지난 10개월간 이 순간을 위해 열심히 달려왔는데, 탈락의 명분을 만드려는 회피인지 면접 준비를 계속 피하게되고 머리에도 들어오지 않았다. 그래도 남은 2일은 최선을 다해 준비해야겠다.



### 2022/11/07/월

오늘 삼성 면접을 보고왔다. 인성, 창의, 적성 순서로 봤으며 오후타임 중엔 내가 가장 먼저 시작하고 거의 가장 먼저 끝났다. 대기실에서 인성문제풀이가 끝나자 마자 면접실에 들어가서 너무 정신이 없었는데, 그래도 망하진 않고 준비한 정도로 본 것 같았다. 창의는 분위기가 좋았다. 인상깊다, 재밌다 이런 얘기가 계속 나왔고 답변도 어느정도 술술 나왔다. 이때까지만 해도 가능성이 높다 생각했지만, 자만의 죄인가, 적성은 이보다도 못 볼 수가 있나 싶게 못봤다. 미리 주어지는 문제부터 당황스러웠다. 모두 내가 모르는 것들이였고, 아는한 최대한 답변을 하더라도 진짜 아무 의미없는 수준의 외침이였다. 들어가서 문제에 대한 답을 하는데 고개를 계속 저으시길레 자신감이 하락하고 어.. 음 만 계속 하게된 것 같다. 이번 경험을 계기로 하여 다음 상반기땐 진짜 꼭 붙을 수 있도록 할 것이다.



### 2022/11/08/화

오전에는 스타일링을 시작했다. 처음에 tailwind로 할까 했지만, 웹 볼륨도 적기에 그냥 CSS로 하기로 결정했다.

오후에는 교보재들이 와서 거울을 재작했다. 나무 프레임을 조립하고 거울 시트지를 붙였다. 어제의 여파로 집중이 잘 안됐는데, 기기 패키징같은걸 할 수 있어서 다행이였다.



### 2022/11/09/수

스타일링을 거의 끝냈다. 페이지 수가 워낙 적고 디자인이 거의 없는 거울용 어플리케이션이라 어렵지 않았다.

거울의 받침대를 붙이는 작업을 했는데, 받침대의 폭이 너무 커서 해체 후 재단한 후 다시 붙였다. 코딩도 재밌지만, 그냥 그런 활동을 같이 하니까 색달랐다. 마지막 프로젝트가 2주도 안남았는데, 공통프로젝트 처럼 엄청 열정을 들이진 못했지만 기억에 많이 남을 것 같다.



### 2022/11/10/목

어제 거의 끝냈던 스타일링을 다 끝냈다.

희욱이가 만든 음성인식 부분을 연결시켰는데, 아직 비동기적으로 작동하는지는 확인하지 못했다.



### 2022/11/11/금

크롬에서 제공하는 speechRecognicion api가 있으며 이를 이용해 희욱이가 STT로직을 짰는데, electron에선 이 API가 사용 불가하다. 구글에서 사용을 못하게 막아놓았다고 하는데, 그래서 다른 유료 API를 사용할까 싶었지만, 이 역시 돈이 나가고 이용하기도 쉬운것이 아니였다. 그래서 express로 작은 서버를 만들고 웹 브라우저를 띄워 socket 통신으로 electron에 정보를 전달해주기로 결정했다.



### 2022/11/14/월

stomp가 왠지 불안정 한 것 같아 stomp library를 바꿨다. 원래 사용하던 것이 앱을 오래 켜두면 stomp가 disconnected 됐다고 뜨는데, 이를 고치려고 지난 프로젝트때 썼던 library를 다시 사용했다.

오후에는 거울 기기 패키징을 마치고, 실제 거울에서 폰트가 작은것 같아 스타일링을 다시 손봤다.

기기 패키징이 생각보다 예쁘게 나와서 다행이고 SW에 좀 더 욕심을 부리고 싶다는 생각이 들었다. 이번 프로젝트가 아무래도 하반기 취업시즌이라 처음부터 모두들 큰 욕심은 갖지 않았는데, 좀 더 열심히 했다면 반우승은 물론 전국발표회에서도 좋은 평가를 얻었을 것이라 생각된다.



### 2022/11/15/화

오전에는 젯슨나노에서 포즈감지를 한 뒤 라즈베리파이로 전하는 정보에 있어 어떤 통신방법을 써야할지 고민이 많았다. 원 계획은 유선잭을 통해 정보를 주고받을 생각이였지만, 젯슨나노와 라즈베리파이가 모두 마스터여서 IO와 같은 슬레이브와의 통신처럼 쉽게 안된다고 한다. 이부분은 팀원분야라 자세히는 모르겠지만, 그래서 다음으로 선택한것이 소켓통신이였다. 통신은 제대로 되지만 젯슨나노쪽이 파이썬으로 작동하여 쓰레드를 쓰는데, 소켓연결과 해제가 자유롭지 못하다고 하여 다른 방식을 찾아야 했다.

그 다음으로 생각해본것은 webRTC 연결과 거울기기로의 알림을 위해 사용하기위해 만들어 놓은 서버와의 stomp 통신이다. 앞 방법에 문제가 있다해서 파이썬에서 stomp 통신이 잘 될 수 있는지 알아봤는데, 결론은 지금 서버와 web에서 하는 방법과 달라 어렵다는 것이였다. 몇시간 알아봤는데 답을 찾지 못했고, 내가 너무 바보처럼 느껴졌다. 결국은 소켓을 잘 이용해보자로 결론지었다. 면접때도 느낀거지만 운영체제와 네트워크에 대한 공부가 빨리 필요할 것 같다.

카운트 다운이나 사진촬영과 같은 몇가지 효과음과 화상연결시 로딩이미지 등을 추가했다.

진동감지센서를 계속 감지하기 위해 webworker를 사용해야 하는데, 구글 복붙과 같은 얕은 방법으로는 잘 되지 않아 내일 공부가 필요할 것 같다.
