### 2022/10/19/수

처음으로 CRA 없이 webpack과 babel, eslint, prettier 설정을 통해 React와 electron 개발환경을 구축했다. 구글링해서 한 것이고, 다시해도 검색없이는 못하겠지만 생각보다 어려운 작업은 없었다. 다만 몇가지 시간이 끌린 작업들이 있었다.

그중 하나는 build시 electron에 아무것도 안뜨는점이 문제였는데, webpack의 HtmlWebpackPlugin이 build시 index.html에 주입해 주는 js 파일의 경로가 잘못되어서였다. webpack output 설정에서 publickPath를 생각없이 복붙했다가 문제가 되었다.

구글링하면 환경변수로 react port 번호나 mode(publish, development) 등을 이용하는데, 환경변수를 사용한 내용을 보면 이런건 어떻게 배우거나 외우는건지 막막하다.

package.json의 한 스크립트에서 여러 명령어를 치려면 && 를 이용한다. 또 어떤 작업을 기다린 후 스크립트를 진행하려면 wait-on을 사용하면 된다.

electron에선 HashRouter 써야한다. url 변화 없이 파일기반 환경이기 때문에 해쉬값만 바꿔가며 보여줄 내용을 구분해야한다.

oracle vm에 라즈비안을 깐 뒤 빌드한 electron 설치파일을 테스트 해보려 했으나 가상환경 OS로 파일 옮기는 방식이 귀찮아서 보류했다.



### 2022/10/20/목

electron과 react간 ipc 통신을 확인했다. 모션인식에 사용되는 라즈베리파이에서 왭과 음성인식을 처리하는 라즈베리 파이로 데이터를 전송하면 electron이 react로 다시 ipc 통신을 하고, react에서 해당 데이터를 보여주거나 서버로 보내는 등의 데이터 처리를 진행한다. electron에서 주어지는 ipcMain과 ipcRenderer객체, webContents 메소드를 이용해 구현 가능하다.

webRTC 통신을 위해서 서버와의 소켓 API 형식을 맞췄다. API 문서에 작성했으며, 앱에서 서버로 실시간 트레이닝을 진행한다고 결정을 날리면 서버는 거울 기기에게 상대방 기기Id를 보내주게 된다. 그러면 기기는 해당 id를 URL일부로 사용하는 소켓을 통해 상대방 기기와 icebracking을 진행한다. 기기간 소켓통신의 경우 body의 type 속성에 2를 넣고 이땐 서버에서 처리없이 그냥 전송만 담당한다. 서버에서 기기로 통신을 시작하라고 기기Id를 전송할 땐 type을 1로 하여 여러 소켓경로를 사용하지 않아도 fe처리를 쉽게 하도록 했다.



### 2022/10/21/금

오늘은 코드를 짜지 않았다. 어제 6시 이후에 계속 개발하다 늦게 자기도 했고, 면접준비에 조금씩 신경써야 할 것 같아 할 일들을 정리하고 CS관련 책을 조금 읽었다. 그 후 팀에서 기기 패키징 설계와 필요 물품을 정리하는회의에 상당히 많은 시간을 들였다.



### 2022/10/24/월

메인 페이지에 띄울 날씨 API를 만졌다. 기상청 API를 활용했는데, 받아오는 내용이 정리되어있지 않아 이를 보여주기 편하게 정리하는 함수를 만들었다. 현 시간부터 12시간 안의 기상예보 데이터는 자세히 정리하며 그 외 데이터는 일별 최저, 최고, 강수확률만 기록하도록 했다.

근데 처음에는 제대로 오던 API가 함수를 완성하자 이상하게 호출되기 시작했다. 정보코드가 다양하게 와야 하는데 하나로 고정되어 왔다. 일당 5000번이니 너무 많이 호출해서 생기는 문제는 아닌데 내일 더 확인하고 고쳐야 겠다.



### 2022/10/25/화

윈도우 환경에서 electron webpack실행이나 window용 exe 파일로 빌드는 잘 되었는데, 라즈베리 파이에서 사용하기 위해 linux 옵션으로 빌드하면 계속 에러가 났다. 이를 위해 1,2시간 가량 찾아보며 이것저것 시도했지만 다 잘 안되었다. 무엇이 문제일까 감이 잘 잡히지 않는다.

어제 가공한 날씨 API결과를 시간별 그래프로 온도를 띄웠다. 메인페이지에서 앞으로 12시간 정도의 온도추이를 쉽게 알 수 있도록 하기 위함이였는데, 생각보다 가시성도 떨어지고 예쁘지 않아 그냥 글자로만 표현할 생각이다.



### 2022/10/26/수

오늘은 2학기 meet up이 있는 날이였고, 오전 미팅을 제외하면 계속 행사에 참여했기에 개발을 할 시간이 없었다. 다음주가 면접이고, 면접 준비도 너무 부족하다고 느끼는데 프로젝트와 면접 준비 어느것을 우선해야 하는지 헷갈리며 둘 다 잘 할 수 있을지도 걱정된다.



### 2022/10/27/목

메인페이지에 날씨와 시간을 단간히 띄워놓고 다음 작업으로 서버에서 소켓통신을 완성해서 전에 만들어둔 webRTC통신이 제대로 작동하는지 확인해보았다.

근데 역시 바로 작동하지 않았으며, 몇 가지 시행착오를 겪고도 오늘 디버깅을 완료하지 못했다. 첫 오류로는 stockJS가 wws protocol을 지원하지 않는다는 것이였다. sockJS는 websocket이나 https long pulling 등 몇 기술을 이용해 websocket이 불가능한 부라우저에서도 실시간 통신이 가능하게 해주는 라이브러리로 알고 있다. 그래서 https를 기본으로 사용하지 않나 싶다. 근데 백에선 지난 프로젝트처럼 구현한것일텐데, 전에는 어떻게 wss를 썼을지도 궁금하다. 이부분은 백에서 코드를 바꿔 해결 할 수 있었다.

다음은 JSON으로 stringify 해서 보내는 객체안에 원시타입이 아닌 참조형 객체를 넣어 보내면 응답이 오지 않는 문제였는데, 이게 잘못된것인지 찾는데 매우 오래걸렸다. 서버는 자바를 사용하고 JSON을 파싱해 객체안에 속성을 넣어 추가적인 편집을 하면서 문제가 생긴것으로 파악된다. 이부분을 백에게 말해주어 서버에서 파싱 후 속성을 넣는등의 편집을 안하고 그대로 보내주니 해결되었다.

다음 문제는 sockJS가 연결되기 전에 send를 하려 하는 등의 리액트 내에서 비동기적 문제들이였다. 이부분을 고치다가 시간이 되어 완료하지 못했다. 스프링을 모르기 때문에 프런트코트만 고쳐가며 디버깅했는데, 스프링도 볼 줄 알았다면 어땠을까 생각이 들었다. 이번 프로젝트가 끝나면 한번 배워봐야겠다.



### 2022/10/28/금

어제 못끝낸 webRTC 디버깅을 끝내고 싶었지만 실패했다. 몇시간 시도해보다 너무 시간이 끌리는 것 같아 다른 작업을 시작했다. 분명 addstream 이벤트까지 잘 작동하는데, 상대방 스트리밍 비디오가 나오지 않는다.

올해, 아니 근 몇년간 한번도 아픈적이 없었는데 환절기에 창문을 열어놓고 잤더니 감기에 걸렸는지 콧물이 나오고 집중이 잘 되지 않았다. 그래서 다른 페이지들의 기본적인 틀을 만드는 것처럼 쉽지만 시간이 조금 걸릴만한 작업들 위주로 했다.
